<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Model Definition | Hitchy ODM Manual</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/odem/assets/css/0.styles.cd4efb57.css" as="style"><link rel="preload" href="/odem/assets/js/app.47f2ab2a.js" as="script"><link rel="preload" href="/odem/assets/js/2.409daf9d.js" as="script"><link rel="preload" href="/odem/assets/js/10.d17d3a56.js" as="script"><link rel="prefetch" href="/odem/assets/js/11.389a94b7.js"><link rel="prefetch" href="/odem/assets/js/12.52dbba5a.js"><link rel="prefetch" href="/odem/assets/js/13.fea93894.js"><link rel="prefetch" href="/odem/assets/js/14.6c70d8a4.js"><link rel="prefetch" href="/odem/assets/js/3.a4ba3380.js"><link rel="prefetch" href="/odem/assets/js/4.09ba3ed8.js"><link rel="prefetch" href="/odem/assets/js/5.f68dad5d.js"><link rel="prefetch" href="/odem/assets/js/6.01b2c65c.js"><link rel="prefetch" href="/odem/assets/js/7.fef621b4.js"><link rel="prefetch" href="/odem/assets/js/8.8912ea23.js"><link rel="prefetch" href="/odem/assets/js/9.9101cb09.js">
    <link rel="stylesheet" href="/odem/assets/css/0.styles.cd4efb57.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/odem/" class="home-link router-link-active"><!----> <span class="site-name">Hitchy ODM Manual</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/odem/" class="nav-link">Home</a></div><div class="nav-item"><a href="/odem/guides/" class="nav-link router-link-active">Guides</a></div><div class="nav-item"><a href="/odem/api/" class="nav-link">API</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/odem/" class="nav-link">Home</a></div><div class="nav-item"><a href="/odem/guides/" class="nav-link router-link-active">Guides</a></div><div class="nav-item"><a href="/odem/api/" class="nav-link">API</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Model Definition</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/odem/guides/defining-models.html#how-to-define" class="sidebar-link">How To Define</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#defining-in-server-side-code" class="sidebar-link">Defining in Server-Side Code</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#defining-in-filesystem" class="sidebar-link">Defining In Filesystem</a></li></ul></li><li><a href="/odem/guides/defining-models.html#definition-syntax" class="sidebar-link">Definition Syntax</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#elements-of-model-definition" class="sidebar-link">Elements of Model Definition</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#actual-properties" class="sidebar-link">Actual Properties</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#computed-properties" class="sidebar-link">Computed Properties</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#instance-methods" class="sidebar-link">Instance Methods</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#hooks-for-life-cycle-events" class="sidebar-link">Hooks for Life-Cycle Events</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#indices" class="sidebar-link">Indices</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#naming-models" class="sidebar-link">Naming Models</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#concluding-with-an-example" class="sidebar-link">Concluding with an Example</a></li></ul></li><li><a href="/odem/guides/defining-models.html#property-types" class="sidebar-link">Property Types</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#strings" class="sidebar-link">Strings</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#numbers" class="sidebar-link">Numbers</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#integers" class="sidebar-link">Integers</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#booleans" class="sidebar-link">Booleans</a></li><li class="sidebar-sub-header"><a href="/odem/guides/defining-models.html#timestamps" class="sidebar-link">Timestamps</a></li></ul></li><li><a href="/odem/guides/defining-models.html#life-cycle-events" class="sidebar-link">Life Cycle Events</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="model-definition"><a href="#model-definition" aria-hidden="true" class="header-anchor">#</a> Model Definition</h1> <h2 id="how-to-define"><a href="#how-to-define" aria-hidden="true" class="header-anchor">#</a> How To Define</h2> <p>There are two ways supported for defining models:</p> <ul><li>In server-side code you may use the Model API directly to define new models.</li> <li>Due to integrating with Hitchy's automatic discovery of extensions it is possible to place model definitions in files expected in certain locations of your project.</li></ul> <p>Both scenarios are described below.</p> <h3 id="defining-in-server-side-code"><a href="#defining-in-server-side-code" aria-hidden="true" class="header-anchor">#</a> Defining in Server-Side Code</h3> <div class="tip custom-block"><p>The preferred way of defining models in a Hitchy application is via filesystem as described below.</p></div> <p>For sure, there is code reading and processing those files. That code is using API to be described in this chapter. You might want to use this API in testing your code e.g. to mock models your code is relying on.</p> <p>The main module of hitchy-plugin-odem library exposes several classes. One of them is <code>Model</code>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span> <span class="token string">&quot;hitchy-plugin-odem&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This class is providing static method <code>Model.define()</code> accepting these arguments:</p> <ul><li><p>First there is the name of the desired model.</p> <p>When defining models via filesystem this name is derived from the file's basename without extension and it is converted from kebab-case to PascalCase there. The resulting model's name is used to expose the model in context of Hitchy's runtime API there.</p> <p>When defining in code you are responsible for applying any such derivations as desired. In this case the model's name isn't used in any sort of registry implicitly and thus might be ignored as well.</p> <div class="tip custom-block"><p class="custom-block-title">Reminder</p> <p>The definition in second argument might contain property <a href="/odem/guides/defining-models-filesystem.html#naming-models"><code>name</code></a> to define a different name. This information is always used in favour of the name provided in first argument here.</p></div> <p>The model's name is used to expose it as part of Hitchy's runtime API. It might be used to name the related set in datasource available via some adapter, as well.</p></li> <li><p>Second argument provides the definition as it is exported by the defining file. The definition is required. It also must define at least one actual property.</p></li> <li><p>An optional third argument may be provided to choose a particular base class the defined model is deriving from. That base class still needs to be derived from <code>Model</code>, though.</p></li> <li><p>A fourth argument might be given to select an adapter to be explicitly used with the resulting model instead of using some globally configured default adapter.</p></li></ul> <p>The full signature is:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span> name<span class="token punctuation">,</span> definition<span class="token punctuation">,</span> baseClass <span class="token operator">=</span> Model<span class="token punctuation">,</span> dataStorageAdapter <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Basically it is okay to stick with the first two arguments:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span> <span class="token string">&quot;hitchy-plugin-odem&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Person <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span> <span class="token string">&quot;person&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		age<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Third argument can be used to create a hierarchy of models:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Model <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span> <span class="token string">&quot;hitchy-plugin-odem&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Person <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span> <span class="token string">&quot;person&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
		age<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;number&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Employee <span class="token operator">=</span> Model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span> <span class="token string">&quot;employee&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
		employedSince<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;date&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> Person <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="defining-in-filesystem"><a href="#defining-in-filesystem" aria-hidden="true" class="header-anchor">#</a> Defining In Filesystem</h3> <p>Hitchy ODM is tightly integrated with Hitchy by means of meeting the latter one's conventions on how to declare server-side models. That's why defining a model basically works just by adding a Javascript file in folder <strong>api/model</strong> of your Hitchy-based project. For example, by creating file <strong>api/model/user.js</strong> you are implicitly defining to have a user model named <code>User</code>.</p> <p>Any such file is assumed to expose the definition of another model. This is possible by sticking with the following pattern:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token operator">&lt;</span>definition<span class="token operator">&gt;</span><span class="token punctuation">;</span>
</code></pre></div><p>In this pattern <code>&lt;definition&gt;</code> must be replaced with the actual definition of a model. A definition's syntax is commonly described below.</p> <p>Any file-based definition of a model is eventually processed through <code>Model.define()</code> as decribed before. The resulting model is then exposed in Hitchy's runtime API. So in a request handler you might use the model as <code>req.api.runtime.models.&lt;ModelName&gt;</code>.</p> <p>The name of a model is derived from the name of the defining file. This derivation assumes filename is given in kebab-case and converts it into PascalCase.</p> <div class="tip custom-block"><p class="custom-block-title">Example</p> <p>To create an application working with models <strong>Post</strong>, <strong>Comment</strong> and <strong>User</strong> you basically need to create files <strong>post.js</strong>, <strong>comment.js</strong> and <strong>user.js</strong> in folder <strong>api/model</strong>. A model named <strong>BlogEditor</strong> would be defined in a file named <strong>api/model/blog-editor.js</strong>.</p></div> <h2 id="definition-syntax"><a href="#definition-syntax" aria-hidden="true" class="header-anchor">#</a> Definition Syntax</h2> <p>The definition of a model always starts with an object. Most properties of this object start another section of definition each defining a different kind of elements per model. In addition some further properties are used to define global information.</p> <div class="tip custom-block"><p class="custom-block-title">Properties vs. Properties</p> <p>This documentation is using the term <em>properties</em> in different situations. For better understanding it is viable to understand those differences.</p> <ul><li><p><strong>Definition properties</strong> are properties of the definition object as described here.</p></li> <li><p><strong>Root-level definition properties</strong> are those properties of the definition object mentioned right before. They start sections of the definition or define global information. In opposition to those all other definition properties are used at deeper levels of definition object's hierarchy.</p></li> <li><p>Defining a model always requires to define the model's properties. These are separated into</p> <ul><li><strong>actual properties</strong> and</li> <li><strong>computed properties</strong></li></ul> <p>with the latter being calculated from the former or any other source of information at runtime of a model's instance.</p></li></ul></div> <h3 id="elements-of-model-definition"><a href="#elements-of-model-definition" aria-hidden="true" class="header-anchor">#</a> Elements of Model Definition</h3> <p>Every definition of a module needs to contain at least one property. As demonstrated before, properties are defined in a separate section of definition named <strong>props</strong>. This section is just one of several supported sections like these:</p> <ul><li><p><strong>props</strong> is defining all <em>actual properties</em>,</p></li> <li><p><strong>computed</strong> defines <em>computed properties</em> that derive their value from actual properties,</p></li> <li><p><strong>methods</strong> lists functions to be exposed as <em>instance methods</em> of resulting model,</p></li> <li><p><strong>hooks</strong> provides lists of functions to be registered as handlers for a limited set of life cycle event.</p></li></ul> <p>Either part is described in detail below.</p> <h3 id="actual-properties"><a href="#actual-properties" aria-hidden="true" class="header-anchor">#</a> Actual Properties</h3> <p>Defining at least one actual property in <strong>props</strong> is mandatory. Every such property definition consists of a unique name for the property and an object describing its type and optional constraints.</p> <div class="warning custom-block"><p>The name of an actual property mustn't be used by any other actual or computed property or method of same model. In addition it may neither start with <code>$</code> nor match name of any life cycle event nor match any of following keywords: <code>prototype</code>, <code>super</code>, <code>constructor</code>, <code>uuid</code>.</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This example is defining two actual properties. Their type defaults to <em>string</em> unless some type is picked explicitly by providing <code>type</code> in property description:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">&quot;integer&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Currently supported types are:</p> <ul><li><code>string</code></li> <li><code>number</code></li> <li><code>integer</code></li> <li><code>date</code></li> <li><code>boolean</code></li></ul> <p>Either types comes with a set of specific constraints to be defined in addition. Some constraints are applicable to either type of property.</p> <h3 id="computed-properties"><a href="#computed-properties" aria-hidden="true" class="header-anchor">#</a> Computed Properties</h3> <p>Computed properties are defined in section <strong>computed</strong> by either one's unique name and the implementation as a function. Those functions are invoked in context of an instance of current model when reading the related computed property. The function is assumed to return any value which is provided as the</p> <div class="warning custom-block"><p>The name of an computed property mustn't be used by any other actual or computed property or method of same model. In addition it may neither start with <code>$</code> nor match name of any life cycle event nor match any of following keywords: <code>prototype</code>, <code>super</code>, <code>constructor</code>, <code>uuid</code>.</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        ageInSeconds<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;integer&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">ageInDays</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ageInSeconds <span class="token operator">/</span> <span class="token number">86400</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Computed properties can be used like regular properties:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> someModelInstance<span class="token punctuation">.</span>ageInDays <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This includes assigning value to a computed property:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>someModelInstance<span class="token punctuation">.</span>ageInDays <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre></div><p>In this case the defined function implementing the computed property's behaviour is invoked with assigned value in first argument:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        ageInSeconds<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> <span class="token string">&quot;integer&quot;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">ageInDays</span><span class="token punctuation">(</span> <span class="token parameter">value</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> value <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ageInSeconds <span class="token operator">/</span> <span class="token number">86400</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            
            <span class="token keyword">this</span><span class="token punctuation">.</span>ageInSeconds <span class="token operator">=</span> value <span class="token operator">*</span> <span class="token number">86400</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="instance-methods"><a href="#instance-methods" aria-hidden="true" class="header-anchor">#</a> Instance Methods</h3> <p>The definition may list methods to be exposed per instance of resulting model. They are provided in section <strong>methods</strong> of definition object. Methods are invoked in context of a particular instance of resulting model, thus using <code>this</code> is available for accessing an instance's properties.</p> <div class="warning custom-block"><p>Arrow functions don't work here for lacking support for <code>this</code>.</p></div> <div class="warning custom-block"><p>The name of a method mustn't be used by any other actual or computed property or method of same model. In addition it may neither start with <code>$</code> nor match name of any life cycle event nor match any of following keywords: <code>prototype</code>, <code>super</code>, <code>constructor</code>, <code>uuid</code>.</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        password<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">setPassword</span><span class="token punctuation">(</span> <span class="token parameter">clearText</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> 
            <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token function">create_hash</span><span class="token punctuation">(</span> cleartext <span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="hooks-for-life-cycle-events"><a href="#hooks-for-life-cycle-events" aria-hidden="true" class="header-anchor">#</a> Hooks for Life-Cycle Events</h3> <p>In section <code>hooks</code> a listener function for every supported life-cycle event may be defined. A listener is invoked in context of the affected model (except for beforeCreate), thus using <code>this</code> is available to access the affected instance. Arguments passed on calling either hook depends on related life cycle event.</p> <div class="warning custom-block"><p>Arrow functions don't work here for lacking support for <code>this</code>.</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        someProp<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    hooks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">beforeValidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// TODO implement handler, instance is available as `this`</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">Information</p> <p>For improved readability of resulting definition hooks may use prefix <code>on</code> preceding name of life-cycle event with that one's first letter capitalized. Thus, the alias <code>onBeforeValidate</code> can be used in definition instead of <code>beforeValidate</code>. In the schema exposed on resulting model this prefix will be removed, though.</p></div> <h3 id="indices"><a href="#indices" aria-hidden="true" class="header-anchor">#</a> Indices</h3> <p>Defining a model basically does not require definition of indices. However, managing large amounts of instances strongly benefits from indices that support common operations used to search and sort instances by the property covered by either index. Indices result in redundantly stored information and thus shouldn't be created for every property and every operation probably used for searching instances some day. Managing indices has an impact on saving data. Temporary indices also result in Hitchy applications taking more time to come up full. That's why you should explicitly define the indices you need, only.</p> <p>Indices are defined in conjunction with either property just like its type and optional constraints. A property's indices are defined in another definition property named <code>index</code> there. This definition property is listing comparison operations presumably used on finding instances by this particular property.</p> <div class="warning custom-block"><p>Defining indices work with actual, non-computed properties, only.</p></div> <div class="warning custom-block"><p>Currently, there is no support for multi-property indices.</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        firstName<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            index<span class="token punctuation">:</span> <span class="token string">&quot;eq&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        lastName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        age<span class="token punctuation">:</span> <span class="token punctuation">{</span> 
            type<span class="token punctuation">:</span> <span class="token string">&quot;number&quot;</span><span class="token punctuation">,</span>
            index<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;gt&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;lt&quot;</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This example is declaring indices for the properties <code>firstName</code> and <code>age</code>. It doesn't define an index for property <code>lastName</code>.</p> <p>In case of <code>firstName</code> an index for finding instances having the exactly same value as searched (a.k.a. equality, thus using abbreviation <code>eq</code>) is defined. Since there is only one index defined the comparison operation may be given as string. When compiling model its schema is always exposing this string converted into a single-item array.</p> <p>The second case of <code>age</code> is defining two separate indices to be managed for searching instances with <code>age</code> being <strong>g</strong>reater <strong>t</strong>han (thus <code>gt</code>) or <strong>l</strong>ess <strong>t</strong>han (thus <code>lt</code>) some given value. Defining multiple indices requires provision of an array listing either one's operation.</p> <h3 id="naming-models"><a href="#naming-models" aria-hidden="true" class="header-anchor">#</a> Naming Models</h3> <p>The name of a model is provided as first argument to <code>Model.define()</code>. In case of defining via filesystem this name is derived from the defining file as described before.</p> <p>However, every definition of a model may provide an explicit name to use instead. This name must be provided in special root-level definition property <code>name</code>.</p> <div class="warning custom-block"><p class="custom-block-title">Limitations</p> <p>Due to using a model's name in string interpolations in context of evaluated code model names have to start with a latin letter followed by a mixture of further latin letters, digits and underscores.</p> <ul><li><strong>Good:</strong> My5thGrade_YearBook_</li> <li><strong>Bad:</strong> My 5.-Grade Year Book <em>or</em> My-5thGrade-YearBook</li></ul></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;MyCustomName&quot;</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        someName<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When putting this in a file <strong>api/model/public-holiday.js</strong> the resulting model won't be implicitly named <strong>PublicHoliday</strong>, but <strong>MyCustomName</strong>.</p> <h3 id="concluding-with-an-example"><a href="#concluding-with-an-example" aria-hidden="true" class="header-anchor">#</a> Concluding with an Example</h3> <p>Let's define a model for managing users:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        lastLogin<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">hasLoggedInBefore</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>lastLogin <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">lockAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token string">&quot;LOCKED&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">unlockAccount</span><span class="token punctuation">(</span> <span class="token parameter">newPassword</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> <span class="token function">create_hash</span><span class="token punctuation">(</span> newPassword <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    hooks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">saved</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// invoked when instance has been saved in database ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="property-types"><a href="#property-types" aria-hidden="true" class="header-anchor">#</a> Property Types</h2> <p>As described before every defined property is bound to one out of several supported types. Properties not picking any type explicitly are using type <em>string</em> by default. The following example defines two properties of type <em>string</em>.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The same can be achieved by picking types explicitly like this:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        name<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">&quot;string&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span> <span class="token string">&quot;string&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In property definitions the <code>type</code> information selects a <em>type handler</em> which is affecting the property's processing in many different ways.</p> <ul><li>It implements a type-specific coercion which is used to convert all kinds of different values assigned to a property being converted to the property's actual type.</li> <li>It provides type-specific methods for serializing and unserializing values to persistently store them in a connected data storage.</li> <li>Either type handler contains a method for comparing values of its type supporting a set of possible comparison operations.</li> <li>Eventually, support for defining constraints and for obeying those as part of validation processes strongly depends on the defined type of a property. Some common constraints are available without regards to the property's type, though.</li></ul> <h3 id="strings"><a href="#strings" aria-hidden="true" class="header-anchor">#</a> Strings</h3> <p>Strings are declared with <code>type: &quot;string&quot;</code> or by omitting the declaration property <code>type</code> altogether.</p> <p>Attributes of type <code>string</code> are capable of holding a sequence of arbitrary characters. The following declaration properties customize the way either string attribute gets processed and validated.</p> <h4 id="trim"><a href="#trim" aria-hidden="true" class="header-anchor">#</a> trim</h4> <p>This boolean declares whether values should be trimmed implicitly or not. By trimming a string value all leading and trailing whitespace gets removed.</p> <h4 id="reducespace"><a href="#reducespace" aria-hidden="true" class="header-anchor">#</a> reduceSpace</h4> <p>This boolean declares whether whitespace should be normalized or not. Normalization refers to replacing all sequences of multiple whitespaces by a single SPC character.</p> <h4 id="uppercase"><a href="#uppercase" aria-hidden="true" class="header-anchor">#</a> upperCase</h4> <p>This boolean demands to replace any lowercase letter in value by its uppercase counterpart.</p> <h4 id="lowercase"><a href="#lowercase" aria-hidden="true" class="header-anchor">#</a> lowerCase</h4> <p>This boolean demands to replace any uppercase letter in value by its lowercase counterpart.</p> <h4 id="minlength"><a href="#minlength" aria-hidden="true" class="header-anchor">#</a> minLength</h4> <p>This integer attaches constraint requiring any optionally trimmed value with whitespace optionally reduced to consist of this number of characters at least.</p> <h4 id="maxlength"><a href="#maxlength" aria-hidden="true" class="header-anchor">#</a> maxLength</h4> <p>This integer attaches constraint requiring any optionally trimmed value with whitespace optionally reduced to consist of this number of characters at most.</p> <h4 id="pattern"><a href="#pattern" aria-hidden="true" class="header-anchor">#</a> pattern</h4> <p>This regular expression attaches constraint requiring any value to match this pattern. Provided pattern might be literally a regular expression or some string containing it.</p> <h4 id="required"><a href="#required" aria-hidden="true" class="header-anchor">#</a> required</h4> <p>This boolean attaches constraint controlling whether this attribute requires a value or not. When set <code>true</code> instances of the model mustn't be saved without providing value for this attribute.</p> <h3 id="numbers"><a href="#numbers" aria-hidden="true" class="header-anchor">#</a> Numbers</h3> <p>Numbers are declared with <code>type: &quot;number&quot;</code>.</p> <p>Attributes of type number are capable of holding numeric values with decimal digits.</p> <h4 id="step"><a href="#step" aria-hidden="true" class="header-anchor">#</a> step</h4> <p>This numeric value results in snapping numbers to multitudes of this value related to configured minimum value in declaration property <code>min</code> or to 0 on omitting that declaration property.</p> <div class="tip custom-block"><p>Declaring step size <code>1.0</code> while having integer minimum value constraint in <code>min</code> limits values to be integers, though they are still handled as fractional numbers without decimal digits.</p></div> <h4 id="min"><a href="#min" aria-hidden="true" class="header-anchor">#</a> min</h4> <p>This numeric value attaches constraint requiring any value to be greater than this value or equal it.</p> <h4 id="max"><a href="#max" aria-hidden="true" class="header-anchor">#</a> max</h4> <p>This numeric value attaches constraint requiring any value to be less than this value or equal it.</p> <h4 id="required-2"><a href="#required-2" aria-hidden="true" class="header-anchor">#</a> required</h4> <p>This boolean attaches constraint controlling whether this attribute requires a value or not. When set <code>true</code> instances of the model mustn't be saved without providing value for this attribute.</p> <h3 id="integers"><a href="#integers" aria-hidden="true" class="header-anchor">#</a> Integers</h3> <p>A separate type handler is provided to particularly handle <em>integers</em>. This type handler is used when declaring a property with <code>type: &quot;integer&quot;</code>.</p> <p>The type handler provides the same options as the more common type handler for numbers though working with any constraint value limited to integer values as well.</p> <h3 id="booleans"><a href="#booleans" aria-hidden="true" class="header-anchor">#</a> Booleans</h3> <p>Booleans are declared with <code>type: &quot;boolean&quot;</code>.</p> <p>Boolean values are <code>true</code> and <code>false</code>.</p> <h4 id="isset"><a href="#isset" aria-hidden="true" class="header-anchor">#</a> isSet</h4> <p>This boolean attaches constraint requiring any provided value to be <code>true</code>.</p> <h4 id="required-3"><a href="#required-3" aria-hidden="true" class="header-anchor">#</a> required</h4> <p>This boolean attaches constraint controlling whether this attribute requires a value or not. When set <code>true</code> instances of the model mustn't be saved without providing value for this attribute.</p> <h3 id="timestamps"><a href="#timestamps" aria-hidden="true" class="header-anchor">#</a> Timestamps</h3> <p>Timestamps are declared with <code>type: &quot;date&quot;</code>.</p> <p>Values are represented using instance of Javascript's native class for <code>Date</code>. Due to supported coercion it's possible to assign strings as well using a limited set of formats.</p> <h4 id="time"><a href="#time" aria-hidden="true" class="header-anchor">#</a> time</h4> <p>This boolean declaration property results in timestamps being stripped off their time of day information. It must be set <code>false</code> explicitly to achieve that.</p> <h4 id="step-2"><a href="#step-2" aria-hidden="true" class="header-anchor">#</a> step</h4> <p>This numeric value is a number of milliseconds timestamp values are snapped to. The snapping occurs related to a given minimum timestamp declared in <code>min</code>.</p> <h4 id="min-2"><a href="#min-2" aria-hidden="true" class="header-anchor">#</a> min</h4> <p>This timestamp attaches constraint requiring any value to be greater than this timestamp or equal it.</p> <p>The value might be given as string complying with a limited set of formats, as a string providing number of milliseconds since midnight of January 1st, 1970 or as an instance of Javascript's natively supported class <code>Date</code>.</p> <h4 id="max-2"><a href="#max-2" aria-hidden="true" class="header-anchor">#</a> max</h4> <p>This timestamp attaches constraint requiring any value to be less than this timestamp or equal it.</p> <p>The value might be given as string complying with a limited set of formats, as a string providing number of milliseconds since midnight of January 1st, 1970 or as an instance of Javascript's natively supported class <code>Date</code>.</p> <h4 id="required-4"><a href="#required-4" aria-hidden="true" class="header-anchor">#</a> required</h4> <p>This boolean attaches constraint controlling whether this attribute requires a value or not. When set <code>true</code> instances of the model mustn't be saved without providing value for this attribute.</p> <h2 id="life-cycle-events"><a href="#life-cycle-events" aria-hidden="true" class="header-anchor">#</a> Life Cycle Events</h2> <p>When working with a model's instance it passes several stages of its <em>life cycle</em>. In either stage callbacks can be registered to be invoked as soon as the related <em>life cycle event</em> occurs.</p> <div class="tip custom-block"><p class="custom-block-title">Are there real events?</p> <p>The term <em>event</em> has been chosen explicitly to help understanding the intention. However, in difference to other systems using events there is no actual event emitted and dispatched. Instead any callback defined for listening to a <em>life cycle event</em> is exclusively invoked when available. If there is no callback then there is no <em>event</em> handling at all.</p> <p>This is why the section is actually named <strong>hooks</strong> for this term is closer to the real functionality.</p></div> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    hooks<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">afterSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// invoked when instance has been saved in database ...</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>This example declares a callback to be invoked after having saved an instance of this model. <code>this</code> is referring to the affected instance.</p> <p>See the <a href="../api/model#hooks">Model API regarding hooks</a> for a full list of supported life cycle events.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/odem/glossary.html" class="prev">
          Glossary
        </a></span> <span class="next"><a href="/odem/guides/using-models.html">
          Using Models
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/odem/assets/js/app.47f2ab2a.js" defer></script><script src="/odem/assets/js/2.409daf9d.js" defer></script><script src="/odem/assets/js/10.d17d3a56.js" defer></script>
  </body>
</html>
